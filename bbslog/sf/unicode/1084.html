<!DOCTYPE html><html><head><meta charset='utf-8'><title>カレントディレクトリの厄介なお話(1/2)</title><link rel='stylesheet' href='bbs.css' /><script src='bbs.js'></script><body><ul class="side"><a href="./" class="toindex">←Unicode版開発トップへ</a><li><div class="list-title">
    <span class="no">1084</span>
    <a class="title" href="1084.html#1084">カレントディレクトリの厄介なお話(1/2)</a></div>
    <ul><li><div class="list-title">
    <span class="no">1085</span>
    <a class="title" href="1084.html#1085">カレントディレクトリの厄介なお話(2/2)</a></div>
    </li></ul></li></ul><ul class="main"><li><section><h1 id=1084>
    <span class="no">[1084]</span>
    <a class="title" href="#1084">カレントディレクトリの厄介なお話(1/2)</a>
    <span class="author">もか</span>
    <time datetime="2009-12-21T03:42:18">2009年12月21日 03:42</time></h1>
    <div class="body">とりあえず知っていることをまとめてみました。長いです。ごめんなさい。<br><br>まずいままでの推移。INCMを駆使して探しました。<br>INCMで探すのが面倒なのでタイトルと日付つき。<br>&gt;&gt;dev:651 テスト版置きました 01/08/28<br>コントロールプロセスのカレントをsakuraのディレクトリに。<br>&gt;&gt;data:2152 [提案]カレントディレクトリ 02/07/31<br>私の妄想。いまだに外部コマンド実行では指定できない。<br>なお外部コマンド実行の「カレントディレクトリを設定できるように」の要望はGAEさんが先。&gt;&gt;data:523<br>&gt;&gt;dev:2277 fix020818.zip 02/08/22<br>要望を書いてから22日たったけど返信がなくてさびしいのでパッチを書いた。<br>実ははるか昔はダイアログを開くと勝手に変わるので、<br>「たまたまファイル＝カレントディレクトリ」になってた。<br>コマンドプロンプトで、 C:\&gt;sakura.exe D:\folder\file.txt<br>とするとカレントディレクトリ=C:\のままファイルを開いた。<br>このときの相対タグジャンプおよび外部コマンド実行はもちろんC:\からの相対だった。<br>それはそれで便利な気もするけど。<br>もともとエクスプローラは開いているパスをカレントにしてプログラムを実行しているのでそれと食い違う。(たぶん)<br>それをファイルの場所＝カレントディレクトリに固定するようにした。<br>リリースでいうと1.3.3.0で統合されたみたい。<br>&gt;&gt;data:2699 要望：新規保存時のダイアログの初期フォルダ 03/02/05<br>カレントディレクトリにして欲しい。<br>返信で「最近使ったファイルの一番上のファイル」に2002/9/9に変更したという記述。<br>&gt;&gt;dev:2638 1.3.8.1の取り込み＆修正 03/03/30<br>これはカレントディレクトリにしたという確認<br>&gt;&gt;data:2848 1.3.8.1 03/03/30<br>そのリリース記事。<br>&gt;&gt;data:3028 1.3.10.1 03/06/23<br>タスクバー(Ctrl+Alt+Z)からの新規作成はカレントディレクトリがMRU0番目になるように変更<br>1.3.8.1より前はカレントディレクトリ＝sakura.exeでファイル保存の初期フォルダがMRU0という動作だったはず。<br>(違いは後述)<br>&gt;&gt;data::6576 【不具合】フォルダが削除できない 08/02/06<br>ウィンドウを開いているとカレントディレクトリになって削除できないフォルダがあるという話<br></div></section>
    <ul><li><section><h1 id=1085>
    <span class="no">[1085]</span>
    <a class="title" href="#1085">カレントディレクトリの厄介なお話(2/2)</a>
    <span class="author">もか</span>
    <time datetime="2009-12-21T03:46:51">2009年12月21日 03:46</time></h1>
    <div class="body">続きです。<br>新規ウィンドウは、&gt;&gt;unicode:1072 anonymouseさんの解説のようになってます。<br><br>カレントディレクトリに依存している部分というのがいくつかあって<br>・相対タグジャンプ(たぶんctagsダイレクトタグジャンプを含む)<br>・外部コマンド実行<br>・(無題)時の「開く」コマンドのダイアログの初期値<br>・「名前をつけて保存」のダイアログの初期値<br>・Grepの現フォルダ(ソース見てないけどファイルを開いてないとき限定)<br>・もしかしたらtagsの作成<br>・DLL類の検索パス(設定できるものは設定依存)<br>これらはファイルを開いていようが無題だろうが同じです。<br>だからファイルを開いている途中で変更するとあんまり良くない現象がおきます。<br>ちなみに今どこよ？ってときは、 外部コマンド実行で「cd」でわかります。<br>特殊な場合で、存在しないフォルダ内の存在しないファイルを新規で開くという場合もあります。<br>コマンドラインから指定可能です。その場合は上書き保存に失敗しますし、カレントディレクトリの移動にも失敗しています。<br><br>編集中のカレントディレクトリ変更機能は、(無題)のときだけにするほうが良いと個人的には思います。<br>各カレントディレクトリ依存機能を依存しないように変更するというのもいいと思います。<br>新規ウィンドウは、xxxxフォルダをカレントにするオプションというのもいいかもしれません。<br>ファイルを開くダイアログの初期値は、オプションを追加すれば良いと思います。<br>どういうオプションにするかは詰める必要があります。<br>・必ず指定フォルダへ<br>・カレントディレクトリ<br>・MRU0番目（ないときはどうするかしりません)<br>と３択にしてあればある程度の要求にこたえられるでしょう。<br>あと、インストーラが作ってくれるショートカットの作業フォルダは空っぽなので、それをマイドキュメントとかにできたらいいかなーとは思います。<br>じつはそれだけで解決するような気がしてきました。<br>ちなみに、OFN_NOCHANGEDIR はOSの種類と使う関数で違うので信用できない上、指定してあってもダイアログ表示中は、<br>その表示中のフォルダに勝手に変わるダメ仕様なのでシングルプロセス版にするときに注意です。<br>最新OSなら大丈夫かもしれないです。<br></div></section>
    </li></ul></li></ul></body></html>