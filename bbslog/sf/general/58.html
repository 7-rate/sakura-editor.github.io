<!DOCTYPE html><html><head><meta charset='utf-8'><title>ときどきiniの設定がなくなります。</title><link rel='stylesheet' href='bbs.css' /><script src='bbs.js'></script><body><ul class="side"><a href="./" class="toindex">←一般トップへ</a><li><div class="list-title">
    <span class="no">58</span>
    <a class="title" href="58.html#58">ときどきiniの設定がなくなります。</a></div>
    <ul><li><div class="list-title">
    <span class="no">60</span>
    <a class="title" href="58.html#60">Re:ときどきiniの設定がなくなります。</a></div>
    <ul><li><div class="list-title">
    <span class="no">61</span>
    <a class="title" href="58.html#61">Re2:ときどきiniの設定がなくなります。</a></div>
    <ul><li><div class="list-title">
    <span class="no">62</span>
    <a class="title" href="58.html#62">Re3:ときどきiniの設定がなくなります。</a></div>
    <ul><li><div class="list-title">
    <span class="no">63</span>
    <a class="title" href="58.html#63">Re4:ときどきiniの設定がなくなります。</a></div>
    <ul><li><div class="list-title">
    <span class="no">69</span>
    <a class="title" href="58.html#69">バージョンチェックの不思議</a></div>
    <ul><li><div class="list-title">
    <span class="no">74</span>
    <a class="title" href="58.html#74">Re:バージョンチェックの不思議</a></div>
    </li></ul></li><li><div class="list-title">
    <span class="no">79</span>
    <a class="title" href="58.html#79">Re5:ときどきiniの設定がなくなります。</a></div>
    </li></ul></li></ul></li></ul></li></ul></li><li><div class="list-title">
    <span class="no">80</span>
    <a class="title" href="58.html#80">原因が分かりました</a></div>
    <ul><li><div class="list-title">
    <span class="no">81</span>
    <a class="title" href="58.html#81">（補足）原因が分かりました</a></div>
    </li></ul></li></ul></li></ul><ul class="main"><li><section><h1 id=58>
    <span class="no">[58]</span>
    <a class="title" href="#58">ときどきiniの設定がなくなります。</a>
    <span class="author">あろか</span>
    <time datetime="2001-01-29T23:23:22">2001年01月29日 23:23</time></h1>
    <div class="body">ありがたく常用しています。<br><br>バグ報告します。<br>テキストエディタで設定した項目が消えてしまうことがあります。<br>まったくなくなるのではなく、数日前の状態に戻る感じです。<br>「最近使ったファイル」などの内容もいっしょに古くなります。<br><br>WindowsNT4.0を使用していて、ログオフや再起動をした後に起こりやすいようです。<br>Windows98のときは気がつかないのでNTの問題なのでしょうか？<br>新しいバイナリにしたときはini丸ごと作り直しているのでなかなか気付きませんでした。<br></div></section>
    <ul><li><section><h1 id=60>
    <span class="no">[60]</span>
    <a class="title" href="#60">Re:ときどきiniの設定がなくなります。</a>
    <span class="author">げんた</span>
    <time datetime="2001-01-30T09:48:42">2001年01月30日 09:48</time></h1>
    <div class="body">▼ あろかさん<br>&gt; テキストエディタで設定した項目が消えてしまうことがあります。<br>&gt; まったくなくなるのではなく、数日前の状態に戻る感じです。<br>&gt; 「最近使ったファイル」などの内容もいっしょに古くなります。<br>数日前って，数日に1回しかマシンを再起動しないんですか(@_@)? 正しく保存されない可能性があるというのは理解できますが，複数世代さかのぼるというのは考えにくいんですが．<br><br>&gt; WindowsNT4.0を使用していて、ログオフや再起動をした後に起こりやすいようです。<br>&gt; Windows98のときは気がつかないのでNTの問題なのでしょうか？<br>以前も同様の指摘があってWM_CLOSEやWM_QUERYENDSESSIONの処理をチェックしたのですが，それといって変なところは見あたりませんでした．Windows終了時のWM_QUERYENDSESSIONの発行され方がNTと95/98で異なるのは知っていますが，それがどのように関係しているかは現時点ではよくわかりません．</div></section>
    <ul><li><section><h1 id=61>
    <span class="no">[61]</span>
    <a class="title" href="#61">Re2:ときどきiniの設定がなくなります。</a>
    <span class="author">KENCH</span>
    <time datetime="2001-01-30T11:24:28">2001年01月30日 11:24</time></h1>
    <div class="body">&gt; 以前も同様の指摘があってWM_CLOSEやWM_QUERYENDSESSIONの処理をチェックしたのですが，それといって変なところは見あたりませんでした．Windows終了時のWM_QUERYENDSESSIONの発行され方がNTと95/98で異なるのは知っていますが，それがどのように関係しているかは現時点ではよくわかりません．<br>　想像ですが、ＮＴで、Iniファイルがディスクトップ上に有る場合で、ユーザ毎にディスクトップが切り替わると、設定したユーザ以外でログインしたら設定が戻ったような錯覚になるやも。</div></section>
    <ul><li><section><h1 id=62>
    <span class="no">[62]</span>
    <a class="title" href="#62">Re3:ときどきiniの設定がなくなります。</a>
    <span class="author">げんた</span>
    <time datetime="2001-01-30T13:14:45">2001年01月30日 13:14</time></h1>
    <div class="body">▼ KENCHさん<br>&gt; ＮＴで、Iniファイルがディスクトップ上に有る場合<br>Iniファイルがデスクトップ or マイコンピュータにあるということはsakura.exeもそこにあるということでは？ユーザ毎に本体をおくというのは考えにくいですが．</div></section>
    <ul><li><section><h1 id=63>
    <span class="no">[63]</span>
    <a class="title" href="#63">Re4:ときどきiniの設定がなくなります。</a>
    <span class="author">じぇぷろ</span>
    <time datetime="2001-01-30T15:10:18">2001年01月30日 15:10</time></h1>
    <div class="body">更新時に古いexeを移動だけにしてませんか？<br>削除かリネームをしないと、ショートカットが気を利かせすぎて<br>移動ファイルの方を起動しに行ってしまうことがあります。<br>あるいは常駐したままログオフとか。常駐していると設定を<br>変えてもiniを吐き出すのは常駐終了時だけです。(確か(^_^;))<br>ログオフで常駐終了時に失敗しているのかもしれません。<br>あるいはいくつかのバージョンをあちこちに入れてませんか？<br>私はデスクトップ上に各種バージョンを取り揃えております。(^_^;)<br>そのショートカットキーの行き先は？<br>バージョンチェックに引っかからないマイナーチェンジの場合、<br>実際には違うバージョンのものを起動しても動いてしまいます。<br>多分iniの仕様が同じバージョンでは中身が違っても起動できる<br>仕掛けなんでしょう。ただ、その時常駐していると、そっちの<br>iniとごちゃ混ぜ(というか常駐の方？)になるようです。だから<br>常駐アイコンのTipにバージョンも表示できるようにしたんです。</div></section>
    <ul><li><section><h1 id=69>
    <span class="no">[69]</span>
    <a class="title" href="#69">バージョンチェックの不思議</a>
    <span class="author">じぇぷろ</span>
    <time datetime="2001-01-30T19:12:51">2001年01月30日 19:12</time></h1>
    <div class="body">▼ じぇぷろさん<br>&gt; バージョンチェックに引っかからないマイナーチェンジの場合、<br>&gt; 実際には違うバージョンのものを起動しても動いてしまいます。<br>&gt; 多分iniの仕様が同じバージョンでは中身が違っても起動できる<br>&gt; 仕掛けなんでしょう。<br><br>1.2.24.0から1.2.25.1までは同時起動できます。1.2.23.0は<br>持ってないので試せません。1.2.25.2ではFileVersionを1.2に<br>固定したのが理由かわかりませんがiniに互換性があるにもかかわらず、<br>同時起動できません。こうなるとバージョンチェックはURの3番目と<br>いうわけでもなさそうです。</div></section>
    <ul><li><section><h1 id=74>
    <span class="no">[74]</span>
    <a class="title" href="#74">Re:バージョンチェックの不思議</a>
    <span class="author">げんた</span>
    <time datetime="2001-01-30T20:45:14">2001年01月30日 20:45</time></h1>
    <div class="body">内部で使っているWindows共有メモリの形式が異なるものは同時起動できないようにしてあります．この機構は昨年の10月くらいに組み込んだもので，具体的にはCShareData.cppの先頭にあるuShareDataVersion変数の値が異なるものは同時に起動できません．<br><br>なぜこうなっているかというと，共有メモリの形式が異なるものを同時起動して使うとWindows NTごとBlue Screenになってしまうなど重大な障害がでるからです．<br><br>表面的にはほとんど同じでもこのチェックに引っかかる場合は私が何か機能を追加しようと途中まで作りかけたままになっている可能性が高いです(^^ゞ．とりあえず変数だけ先に追加して機能部分を後で何とかしようと思ったような記憶がなきにしもあらず...</div></section>
    </li></ul></li><li><section><h1 id=79>
    <span class="no">[79]</span>
    <a class="title" href="#79">Re5:ときどきiniの設定がなくなります。</a>
    <span class="author">あろか</span>
    <time datetime="2001-01-31T00:10:45">2001年01月31日 00:10</time></h1>
    <div class="body">たくさんの回答ありがとうございます。<br><br>こちらの状況説明が不充分でした。もうしわけありません。<br>・インストールはProgram Files￥sakuraフォルダに上書きコピーしています。<br>たまに古いのを削除してからコピーすることもあります。（ゴミ箱へ「移動」も原因になるのでしょうか？）<br>・「ini消滅対策」のため、sakura.iniをときどきバックアップしており、スタートアップに”copy sakura.ini2 sakura.ini”という1行バッチをいれていました。<br>（←ここではパスは省略しています。）「数日前」になるのは、これが原因でした。いらぬ疑問を誘い申し訳ありません。<br>・常駐したままでログオフやシャットダウンしています。Win98では問題ありませんでした。<br><br>Win98とNTで終了時の挙動が異なるとの説明がありましたので半分納得致しました。が、利便性を考えると毎回常駐終了するのは面倒です。<br>ソースを拝見しましたが、WM_QUERYENDSESSIONのときにはiniを保存していないようですね。<br>この辺が原因なのでしょうか？（コンパイルできる環境がbccしかないので手は出してません。すみません）<br><br>以上です。<br><br>追伸<br>▼ じぇぷろさん<br>（略）<br>&gt; バージョンチェックに引っかからないマイナーチェンジの場合、<br>&gt; 実際には違うバージョンのものを起動しても動いてしまいます。<br>&gt; 多分iniの仕様が同じバージョンでは中身が違っても起動できる<br>&gt; 仕掛けなんでしょう。ただ、その時常駐していると、そっちの<br>&gt; iniとごちゃ混ぜ(というか常駐の方？)になるようです。だから<br>&gt; 常駐アイコンのTipにバージョンも表示できるようにしたんです。<br>Win98では複数のバージョンを起動するとすでにメモリにいるDLLが使われると思います。<br>bccで遊んでいた頃はそうなっていました。<br></div></section>
    </li></ul></li></ul></li></ul></li></ul></li><li><section><h1 id=80>
    <span class="no">[80]</span>
    <a class="title" href="#80">原因が分かりました</a>
    <span class="author">げんた</span>
    <time datetime="2001-01-31T01:49:54">2001年01月31日 01:49</time></h1>
    <div class="body">原因はWM_ENDSESSIONメッセージを処理していないことでした．<br><br>以下引用<br>The WM_ENDSESSION message is sent to an application after the system processes the results of the WM_QUERYENDSESSION message. The WM_ENDSESSION message informs the application whether the session is ending. <br><br>A window receives this message through its WindowProc function<br><br>▼Parameters<br>wParam: Specifies whether the session is being ended. If the session is being ended, this parameter is TRUE; otherwise, it is FALSE. <br><br>▼Remarks<br>If the wParam parameter is TRUE, the session can end any time after all applications have returned from processing this message. Therefore, an application should perform all tasks required for termination before returning from this message. <br><br>The application need not call the DestroyWindow or PostQuitMessage function when the session is ending. <br><br>と言うわけで，WM_ENDSESSIONが来たときはWM_DESTROYはもとよりメッセージループも呼ばれることなく終了してしまうので，メッセージループを抜けた後に書かれている保存処理まで到達しません．<br>この問題は次のバージョンで修正します．（じぇぷろさんも覚えておいてね）</div></section>
    <ul><li><section><h1 id=81>
    <span class="no">[81]</span>
    <a class="title" href="#81">（補足）原因が分かりました</a>
    <span class="author">げんた</span>
    <time datetime="2001-01-31T09:00:33">2001年01月31日 09:00</time></h1>
    <div class="body">&gt; M_ENDSESSIONが来たときは保存処理まで到達しません．<br>以下はどうしてWin95/98ではうまく保存できるのかについての私の予想です．<br><br>現在のコードではWM_QUERYENDSESSIONが来た時点で全ウィンドウを閉じて自分のウィンドウを破棄するようになっています．ですから，WM_ENDSESSIONがくる前に処理を完了できれば正常に終了します．<br><br>WM_QUERYENDSESSIONにかかれている説明を見ると，WinNT/2000ではWM_QUERYENDSESSIONが戻った後は他のアプリとは無関係にすぐWM_ENDSESSIONがくるのに対して，Win95/98ではすべてのアプリがWM_QUERYENDSESSIONに応答した後で初めてWM_ENDSESIONの発行を開始します．<br><br>Win95/98は他のアプリが終了処理をしている間にテキストエディタが自分で正常終了するので一見うまくいっていたように見えただけでその挙動は起動しているアプリの数に依存するのかもしれません．</div></section>
    </li></ul></li></ul></li></ul></body></html>