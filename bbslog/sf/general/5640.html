<!DOCTYPE html><html><head><meta charset='utf-8'><title>折り返し有効時のテキスト全選択ga</title><link rel='stylesheet' href='../bbs.css' /><script src='../bbs.js'></script><body><ul class="side"><a href="./" class="toindex">←一般トップへ</a><li><div class="list-title">
    <span class="no">5640</span>
    <a class="title" href="5640.html#5640">折り返し有効時のテキスト全選択ga</a></div>
    <ul><li><div class="list-title">
    <span class="no">5643</span>
    <a class="title" href="5640.html#5643">Re:折り返し有効時のテキスト全選択ga</a></div>
    </li><li><div class="list-title">
    <span class="no">5644</span>
    <a class="title" href="5640.html#5644">矩形選択も不正動作</a></div>
    </li><li><div class="list-title">
    <span class="no">5645</span>
    <a class="title" href="5640.html#5645">問題回避版をUPしました</a></div>
    <ul><li><div class="list-title">
    <span class="no">5652</span>
    <a class="title" href="5640.html#5652">Re:問題回避版をUPしました</a></div>
    </li></ul></li><li><div class="list-title">
    <span class="no">5650</span>
    <a class="title" href="5640.html#5650">Re:折り返し有効時のテキスト全選択んが</a></div>
    </li><li><div class="list-title">
    <span class="no">5654</span>
    <a class="title" href="5640.html#5654">Re:折り返し有効時のテキスト全選択ga</a></div>
    <ul><li><div class="list-title">
    <span class="no">5655</span>
    <a class="title" href="5640.html#5655">Re2:折り返し有効時のテキスト全選択ga</a></div>
    <ul><li><div class="list-title">
    <span class="no">5657</span>
    <a class="title" href="5640.html#5657">Re3:折り返し有効時のテキスト全選択ga</a></div>
    </li></ul></li></ul></li></ul></li></ul><ul class="main"><li><section><h1 id=5640>
    <span class="no">[5640]</span>
    <a class="title" href="#5640">折り返し有効時のテキスト全選択ga</a>
    <span class="author">ぽよん</span>
    <time datetime="2006-11-28T12:41:47">2006年11月28日 12:41</time></h1>
    <div class="body">sakura 1.5.13.0でとりあえずの再現手順です。調査をお願いいたします。<br><br>*1.「現在のウィンドウ幅で折り返し」を有効にする<br>*2.以下のように2行入力("↓"は改行の意味)<br>aaa↓<br>bbb↓<br>*3.2行目の先頭にカーソルを置いてEnter(空行)<br>aaa↓<br>↓<br>bbb↓<br>*4.Ctrl+Aで全選択後、Escapeで解除<br>*5.再度2行目の先頭にカーソルを置いてEnter(空行)<br>*6.Ctrl+Aで全選択しようとすると最終行が選択されない<br></div></section>
    <ul><li><section><h1 id=5643>
    <span class="no">[5643]</span>
    <a class="title" href="#5643">Re:折り返し有効時のテキスト全選択ga</a>
    <span class="author">じゅうじ</span>
    <time datetime="2006-11-29T10:42:09">2006年11月29日 10:42</time></h1>
    <div class="body">２つ前のバージョンからです。Yahoo! Junk に、<br>全選択だけを戻した実行ファイル置きました。<br>sakura_selectall.lzh (VC++6)<br>緊急ですので、直れば消します。</div></section>
    </li><li><section><h1 id=5644>
    <span class="no">[5644]</span>
    <a class="title" href="#5644">矩形選択も不正動作</a>
    <span class="author">ryoji</span>
    <time datetime="2006-11-29T22:41:00">2006年11月29日 22:41</time></h1>
    <div class="body">これ、最新の 1.5.13.0 だけおかしくなってるみたいですね。<br><br>既存ファイルを開いて全選択、ESCで解除してから、最終行以外のところにいくつか改行を追加して再度全選択したときにも最終行付近が選択されなくなっています。<br>全選択以外に、矩形選択の表示も変になってます。<br><br>全選択や矩形選択がおかしくなる典型的なケースについて、途中までの手順をマクロ記録しました。<br>後述のマクロを新規ファイルの状態から実行すると、<br><br>1↓<br>2↓<br>3↓<br>4↓<br>5↓<br>[EOF]<br><br>になって、1↓の行が矩形選択状態になります。<br>マクロは矩形選択モードを解除せずに終わっているので、続けて下矢印キーを４回押せば全部の行が反転するはずですが、3↓の行は反転しません。<br>これに続けて、<br>F5 で表示更新して ESC を入力すると今度は 3↓の行だけ反転します。<br>さらに続けて、<br>F5 で表示更新して Ctrl+Aでは先頭の２行しか選択されません。<br><br>---再現用マクロ---<br>S_Char(52);     // 文字入力<br>S_Char(13);     // 文字入力<br>S_Char(53);     // 文字入力<br>S_Char(13);     // 文字入力<br>S_GoFileTop(0); // ファイルの先頭に移動<br>S_BeginBoxSelect(0);    // 矩形範囲選択開始<br>S_Right(0);     // カーソル右移動<br>S_Down(0);      // カーソル下移動<br>S_CancelMode(0);        // 各種モードの取り消し<br>S_GoFileTop(0); // ファイルの先頭に移動<br>S_Char(49);     // 文字入力<br>S_Char(13);     // 文字入力<br>S_Char(50);     // 文字入力<br>S_Char(13);     // 文字入力<br>S_Char(51);     // 文字入力<br>S_Char(13);     // 文字入力<br>S_GoFileTop(0); // ファイルの先頭に移動<br>S_BeginBoxSelect(0);    // 矩形範囲選択開始<br>S_Right(0);     // カーソル右移動<br>S_Right(0);     // カーソル右移動<br>S_Right(0);     // カーソル右移動<br></div></section>
    </li><li><section><h1 id=5645>
    <span class="no">[5645]</span>
    <a class="title" href="#5645">問題回避版をUPしました</a>
    <span class="author">ryoji</span>
    <time datetime="2006-11-29T23:04:26">2006年11月29日 23:04</time></h1>
    <div class="body">Patches#1557887 「EOFを含む矩形範囲選択でEOF以降が反転」<br>(EOF_reversed2_r1001.diff ---&gt; sakura/trunk#1014)<br>からおかしくなっていると思います。<br><br>EOF位置のキャッシュ機能がおまけで追加されているみたいなんですが、そこだけ部分的に除去したところ &gt;&gt;data:5640, &gt;&gt;data:5644 とも正しく動作している感じです。<br><a href=http://sakura.qp.land.to/?Junk%2F17 target=_top><nobr>http://<wbr>sakura.<wbr>qp.<wbr>land.<wbr>to/?<wbr>Junk%<wbr>2F17</nobr></a><br>（バイナリ＆修正パッチ）<br>EOFキャッシュが正確に動くようになれば問題は無いのかな～と思いますが、その辺りはどう手を入れればいいのか自分もよくわかってないです。<br></div></section>
    <ul><li><section><h1 id=5652>
    <span class="no">[5652]</span>
    <a class="title" href="#5652">Re:問題回避版をUPしました</a>
    <span class="author">もか</span>
    <time datetime="2006-12-01T09:36:23">2006年12月01日 09:36</time></h1>
    <div class="body">▼ ryojiさん, じゅうじさん<br>バグ混入させたみたいです。すみません。<br>緊急の対応ありがとうございます。<br><br>現在コンパイルテスト・確認はとっていないのですが<br>CLayoutMgr_New.cpp(rev 1014)のキャッシュ更新を促す個所は、<br>  845 &#9;if( nCurLine == m_pcDocLineMgr-&gt;GetLineCount() ){<br>  846 &#9;&#9;m_nLineTypeBot = nCOMMENTMODE_Prev;<br>  847 &#9;&#9;// 2006.10.01 Moca 最終行が変更された。EOF位置情報を破棄する。<br>  848 &#9;&#9;m_nEOFColumn = -1;<br>  849 &#9;&#9;m_nEOFLine = -1;<br>  850 &#9;}<br>で、ファイルの途中だけ更新され、<br>かつレイアウト情報更新が末尾までこない場合、<br>この分岐は条件が成立しないのをすっかり忘れていました。<br>よって桁位置が変わった場合は検出可能ですが、<br>行番号だけずれた場合がおかしいようです。<br><br> CLayoutMgr::DoLayout_Rangeの先頭で必ず<br>  m_nEOFColumn = -1;<br>  m_nEOFLine = -1;<br>でとしてキャッシュ更新マークにすれば修正されるはずです。<br></div></section>
    </li></ul></li><li><section><h1 id=5650>
    <span class="no">[5650]</span>
    <a class="title" href="#5650">Re:折り返し有効時のテキスト全選択んが</a>
    <span class="author">じゅうじ</span>
    <time datetime="2006-11-30T03:31:12">2006年11月30日 03:31</time></h1>
    <div class="body">２つ前の、1.5.12.0 (Sep. 23, 2006) <br>[ 1530740 ] 全て選択の選択範囲末尾が不正確<br>の時以降と見ました。それで、<br>--- sakura_core/CEditView_Command.cpp&#9;(revision 987)<br>@@ -2198,7 +2198,12 @@<br>の、ファイルだけ修正を戻しました。<br><br>Yahoo! Junk/sakura_selectall.lzh (VC++6)<br>gentaさんの新規関数をMocaさんがさらに修正されてます。<br><br>（いつもの）＃タスクトレイに常駐しているの、消してから起動してください。</div></section>
    </li><li><section><h1 id=5654>
    <span class="no">[5654]</span>
    <a class="title" href="#5654">Re:折り返し有効時のテキスト全選択ga</a>
    <span class="author">じゅうじ</span>
    <time datetime="2006-12-02T17:09:36">2006年12月02日 17:09</time></h1>
    <div class="body">▼ げんたさん<br>すみません、疑って。<br>全選択で履歴を眺めていたら、最新バージョンのちょうど１つ前に「全選択」という文字があったので、それに決めて後は突っ走ってしまいました。<br>コンパイル＆テスト用のPCを再度確認したら、９月のバージョンはzipすらダウンロードしてませんでした。（やれやれ）<br>多分その時の心境としては、zipで確認する手間を省いたんだと思います。なにせ、とにかく全選択の機能が動く最新版が欲しかったので。<br><br>２つ前と誤ったのは、SourceForge DownloadのFile Releasesに、１番上にあるのが現在の最新バージョンと思わなくて、1.5.13.0 が２つ前と思ってしまいました。WikiのHistoryは、何故か、一番上にテンプレが有って、２番目が最新ですよ。テンプレは、２番目とかに持ってくる…は、別の人ですね。</div></section>
    <ul><li><section><h1 id=5655>
    <span class="no">[5655]</span>
    <a class="title" href="#5655">Re2:折り返し有効時のテキスト全選択ga</a>
    <span class="author">maru</span>
    <time datetime="2006-12-02T18:40:01">2006年12月02日 18:40</time></h1>
    <div class="body">▼ じゅうじさん<br>&gt; WikiのHistoryは、何故か、一番上にテンプレが有って、<br><br>一番上はテンプレではなく、開発中の最新版の意味です。<br>コミットされいてリリース待ちになっている部分、つまり次バージョンで変更が決定している内容をまとめるページです。<br>たまたま今はSVNの最新と1.5.13.0に差異がないので、History/Nextが空っぽになっております。<br><br>リリース時に誰かが変更履歴をまとめるのは結構大変なので、コミットするたびに逐次変更履歴を追記する運用にしております。<br>実は、このHistory/Nextのページこそが、wikiを立ち上げた最大の目的だったりします。<br><br>ちょっと分かりにくいですか？名前（History/Next）が良くないとか。<br></div></section>
    <ul><li><section><h1 id=5657>
    <span class="no">[5657]</span>
    <a class="title" href="#5657">Re3:折り返し有効時のテキスト全選択ga</a>
    <span class="author">じゅうじ</span>
    <time datetime="2006-12-03T16:24:34">2006年12月03日 16:24</time></h1>
    <div class="body">▼ maruさん<br>&gt; ちょっと分かりにくいですか？名前（History/Next）が良くないとか。<br><br>有難う御座います。<br>History/Next は、雛型ではなく別格なのですね。<br>水平線の棒を入れるとか、後は、フォントを変えたりすると、良かったと思います。<br><br>まだ、Historyの話ですが、<br>コンパイル＆テスト用PCと書きましたが、いつも使っている、（この）PCでは、やはり、<br>1.5.12.0 で、不具合が発生していました。<br>開発中のバージョン番号を見て、２つ前だと思ってしまいました、ご迷惑おかけしました。<br>よく見ると、開発中の1.5.13.0 でした、バージョン番号は当然1.5.12.0 です。<br>なぜか、仇を探そうとWiki探しましたけど、私には見つけられ無かったので、Yahoo!のJunk/2006-10-29_RC1 にアップロードして置きます。</div></section>
    </li></ul></li></ul></li></ul></li></ul></body></html>