<!DOCTYPE html><html><head><meta charset='utf-8'><title>パスにunicodeを含む場合のファイルの開き方</title><link rel='stylesheet' href='bbs.css' /><script src='bbs.js'></script><body><ul class="side"><a href="./" class="toindex">←一般トップへ</a><li><div class="list-title">
    <span class="no">3294</span>
    <a class="title" href="3294.html#3294">パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3296</span>
    <a class="title" href="3294.html#3296">Re:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3297</span>
    <a class="title" href="3294.html#3297">Re2:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3303</span>
    <a class="title" href="3294.html#3303">Re3:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3305</span>
    <a class="title" href="3294.html#3305">Re4:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3307</span>
    <a class="title" href="3294.html#3307">Re5:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3309</span>
    <a class="title" href="3294.html#3309">Re6:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3310</span>
    <a class="title" href="3294.html#3310">Re7:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3311</span>
    <a class="title" href="3294.html#3311">Re8:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3312</span>
    <a class="title" href="3294.html#3312">Re9:パスにunicodeを含む場合のファイルの開き方</a></div>
    <ul><li><div class="list-title">
    <span class="no">3315</span>
    <a class="title" href="3294.html#3315">Re10:パスにunicodeを含む場合のファイルの開き方</a></div>
    </li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><ul class="main"><li><section><h1 id=3294>
    <span class="no">[3294]</span>
    <a class="title" href="#3294">パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">ハク</span>
    <time datetime="2003-09-16T01:49:28">2003年09月16日 01:49</time></h1>
    <div class="body">はじめまして、サクラエディタ使わせて頂いております。<br>いきなり質問で申し訳ないのですが<br>題にある通りパスにunicodeが含まれるフォルダがある場合<br>unicode文字が「?」と認識されてしまい、<br>開くことが出来ない状態です。<br>これは現在の仕様なのでしょうか？<br><br>ちなみにnotepadではうまく(unicodeを)認識してくれます<br><br>過去ログを検索したのですが特に無いようなので<br>質問させて頂きました。<br>既出、もしくは設定等で変更可能でしたら<br>申し訳ありません。m(_ _)m</div></section>
    <ul><li><section><h1 id=3296>
    <span class="no">[3296]</span>
    <a class="title" href="#3296">Re:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">wmlhq</span>
    <time datetime="2003-09-16T11:24:10">2003年09月16日 11:24</time></h1>
    <div class="body">▼ ハクさん<br>&gt; 題にある通りパスにunicodeが含まれるフォルダがある場合<br>&gt; unicode文字が「?」と認識されてしまい、<br>&gt; 開くことが出来ない状態です。<br><br>現状ではSJISコードのパスしか開けない仕様です。よろしければ、ドライブのフォーマット形式とWindowsのバージョンを教えてください。ドライブのフォーマット形式は「マイコンピュータ」からドライブを選択して「プロパティ」をクリックすると見れます。</div></section>
    <ul><li><section><h1 id=3297>
    <span class="no">[3297]</span>
    <a class="title" href="#3297">Re2:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">ハク</span>
    <time datetime="2003-09-16T12:46:35">2003年09月16日 12:46</time></h1>
    <div class="body">了解です。<br>環境が二つあるため(会社と自宅)両方載せておきます。<br>両方とも同じく再現します。<br>・Windows2000 sp4<br>  FAT32<br>・WindowsXPPro sp1<br>  NTFS<br><br>となっております。<br>もし情報が不足していましたらご指摘ください。<br><br>余談なのですがやはり実装は難しいのでしょうか。<br>たしか2000以降と9xシリーズでは文字コードの扱いが違ってたはず(・・だと思います(汗))<br>notepadはWinごとに対応すればいいから楽でしょうけど・・</div></section>
    <ul><li><section><h1 id=3303>
    <span class="no">[3303]</span>
    <a class="title" href="#3303">Re3:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">wmlhq</span>
    <time datetime="2003-09-17T11:56:39">2003年09月17日 11:56</time></h1>
    <div class="body">▼ ハクさん<br>&gt; unicode文字が「?」と認識されてしまい、<br>このあたりをもう少し詳しく。文字化けが起こる文字とか、どんな風に表示されるかとか。</div></section>
    <ul><li><section><h1 id=3305>
    <span class="no">[3305]</span>
    <a class="title" href="#3305">Re4:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">ハク</span>
    <time datetime="2003-09-17T17:22:26">2003年09月17日 17:22</time></h1>
    <div class="body">▼ wmlhqさん<br>&gt; &gt; unicode文字が「?」と認識されてしまい、<br>&gt; このあたりをもう少し詳しく。文字化けが起こる文字とか、どんな風に表示されるかとか。<br><br>自分がフォルダ名に使用した文字はUnicode:0x2620(ドクロマークみたいなやつ)です。<br>サクラ自身の出すエラーダイアログは上記のまんまUnicode部分が「?」と表示されます。<br>(例：D:\temp\?UG資料室?\hoge.txt  など)<br>またサクラ自身にクリップボード貼り付け等を行っても「?」と表示されます。<br><br>&gt; 文字化けが起こる文字とか<br>これに関してはShift_JIS表に該当しない文字は「?」となると思います。<br>サクラ自身のソースは拝見したことがないため詳しくはつっこめませんが・・(^^;</div></section>
    <ul><li><section><h1 id=3307>
    <span class="no">[3307]</span>
    <a class="title" href="#3307">Re5:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">wmlhq</span>
    <time datetime="2003-09-18T13:21:17">2003年09月18日 13:21</time></h1>
    <div class="body">開発者の方々へ。そもそもvfatも内部でUnicodeを使っているので、CreateFileW,CreateFileMappingW,GetCommandLineWなどを使うべき。MS Officeでもそのように実装しているはず。win95でもGetCommandLineWは例外的にサポートされているが、その他の関数では下位互換性を保つため、失敗時にGetLastError()==ERROR_NOT_IMPLEMENTEDならばANSIバージョンを呼ぶよう、修正すること。_accessや_lopenなどは古い関数なので、使わない形に修正すべき。いずれにしても、CFile{Read,Write}の周辺は、例外や余分なコードを無くして大幅に修正すべき。</div></section>
    <ul><li><section><h1 id=3309>
    <span class="no">[3309]</span>
    <a class="title" href="#3309">Re6:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">すい</span>
    <time datetime="2003-09-19T01:34:35">2003年09月19日 01:34</time></h1>
    <div class="body">なんだかファイルのread/write周りの事しか書いてないみたいですけど。<br><br>サクラエディタは単純に編集対象のファイルを読み書きしているだけじゃ<br>なくて、あちこちで様々なパス文字列の処理をしているわけで。<br><br>例えば具体例を挙げると、ダイレクト タグ ジャンプなんかだと、<br>ダイレクト タグ ジャンプのための tagsファイルが編集中のファイルと<br>同じディレクトリに無い場合、１階層親階層のディレクトリの中から<br>tags を探し、無ければ更に１階層親階層のディレクトリの中から．．．<br>とかやっていて、それらの親階層たどる処理とかがバリバリの<br>Shift_JIS テキスト処理でやられています。<br><br>この程度だけなら まだ かわいいのですが、この類のパス文字列に対する<br>Shift_JIS 依存テキスト処理がエディタ中のあちこちに散在しているんじゃ<br>ないかと思うのですが．．．<br>それらも全て直さないと駄目という事になるんじゃないでしょうか？<br><br>あと、タイトルバー表示の編集中ファイル名とか。ここも Unicode 処理にするのかな？<br>マクロは？「編集中ファイル名の取得機能では Unicode 特有文字は化ける仕様です」と割り切るのかな？<br>メニューは？過去に編集したファイル。「ファイル(F)→最近使ったファイル(F)」とか、<br>「ファイル(F)→最近使ったフォルダ(D)」とか。<br>Grep の対象のファイル・フォルダ とかは？ 他、ダイアログ諸々。設定画面とか。<br>まぁ表示だけなら「 Unicode特有の文字は表示が化けるけど我慢して」でも<br>済むかもしれませんけど、、、<br>「最近使ったファイル」の一覧だとかは sakura.ini に保存されるわけで、<br>ここも Unicodeで保存しなくてはならなくなるのでは？<br>Unicode特有文字部が化けたら「最近使ったファイル」から開けなくなっちゃいますからね。<br>でもそうなると sakura.ini も Unicode にしないと駄目じゃ．．．<br>ファイルの履歴などのパス部分だけ Unicode で格納するのか？ → Shift_JIS  Unicode 混在テキスト？(汗)<br>それとも sakura.ini 全部を完全に Unicode にしちゃうの？ → それで問題出ない？<br><br>とか。<br><br>単純に<br>「Unicode特有文字をパス中に含むファイルは、とりあえず開く事と<br>　保存する事だけは出来る。」<br>という仕様で割り切って良いならファイルread/write部だけの修正で<br>済むかもしれませんけど、Unicode特有の文字をパスに含むファイルの<br>編集中には、正常に動作しない機能があちこち噴出しそうですよね。<br># ↑んで、それが「編集しているファイルによってはコレコレの機能が<br># 動作しません」とかってユーザーからバグ扱い報告されそうです。<br><br>ちょっと考えただけでも“全面改修”とまではいかないかもしれませんが、<br>エディタ全体に渡る かなり大規模な改修になりそうに思えるのですが。<br>意外にあちこちでパス文字列を参照・加工・利用していると思いますので．．．<br>．．．誰がやるんでしょう？<br></div></section>
    <ul><li><section><h1 id=3310>
    <span class="no">[3310]</span>
    <a class="title" href="#3310">Re7:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">wmlhq</span>
    <time datetime="2003-09-19T11:29:02">2003年09月19日 11:29</time></h1>
    <div class="body">マジレス。<br>&gt; サクラエディタは単純に編集対象のファイルを読み書きしているだけじゃ<br>&gt; なくて、あちこちで様々なパス文字列の処理をしているわけで。<br>劇的に同意。<br><br>&gt; Shift_JIS 依存テキスト処理がエディタ中のあちこちに散在..(中略)..<br>&gt; それらも全て直さないと駄目<br>すべてではありませんが、ほとんどすべてです。<br><br>&gt; あと、タイトルバー表示の編集中ファイル名とか。ここも Unicode 処理にするのかな？<br>&gt; 「ファイル(F)→最近使ったフォルダ(D)」とか。<br>&gt; Grep の対象のファイル・フォルダ とかは？<br>言い忘れましたが、当然そうなります。<br><br>&gt; 編集中ファイル名の取得機能では Unicode 特有文字は化ける<br>CF_UNICODETEXT形式を用意するまでだ！ と思ったが、内部形式がSJISなので表示は駄目。<br><br>&gt; sakura.ini も Unicode にしないと駄目じゃ．．．<br>「バイナリ埋め込み」かDOS形式に。<br><br>&gt; 編集中には、正常に動作しない機能があちこち噴出しそうですよね。<br>&gt; かなり大規模な改修になりそう<br>&gt; ．．．誰がやるんでしょう？<br>諸君の健闘を祈る(爆)。</div></section>
    <ul><li><section><h1 id=3311>
    <span class="no">[3311]</span>
    <a class="title" href="#3311">Re8:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">すい</span>
    <time datetime="2003-09-20T03:57:05">2003年09月20日 03:57</time></h1>
    <div class="body">&gt;&gt; 編集中ファイル名の取得機能では Unicode 特有文字は化ける<br>&gt;CF_UNICODETEXT形式を用意するまでだ！ と思ったが、内部形式がSJISなので表示は駄目。<br><br>これはマクロ中での「編集中ファイル名の取得機能」の話をしているのですが。<br>マクロ中では Shift_JIS しか扱えませんよね。<br>WSH が使えるようになれば WSH 部では Unicode も問題なく扱えるようになるかもしれませんが、<br>残念ながらまだ WSHは まともに動作しないわけですし。<br><br>&gt;&gt; sakura.ini も Unicode にしないと駄目じゃ．．．<br>&gt;「バイナリ埋め込み」かDOS形式に。<br><br>DOS形式（8.3形式のMS-DOSファイル名ですよね）は以下の２点より却下。<br><br>理由１<br>　「MS-DOSファイル名」と「ロングファイル名」の対応は入れ替わることがある。<br><br>　例えば FAT のドライブにて、以下のようにファイルが２個ある場合、<br>　・C:\foo\textfile-1.txt&#9;← MS-DOSファイル名は TEXTFI~1.TXT<br>　・C:\foo\textfile-2.txt&#9;← MS-DOSファイル名は TEXTFI~2.TXT<br>　で、過去に C:\foo\textfile-1.txt をエディタで編集し、C:\foo\TEXTFI~1.TXT と<br>　エディタの履歴に記憶されているとします。その後、<br>　１．この２個のファイルを他のフォルダに移動する。<br>　２．textfile-2.txt を先に元の C:\foo\ に戻す。<br>　３．次に textfile-1.txt を元の C:\foo\ に戻す。<br>　と作業すると、ファイル名は<br>　・C:\foo\textfile-1.txt&#9;← MS-DOSファイル名は TEXTFI~2.TXT<br>　・C:\foo\textfile-2.txt&#9;← MS-DOSファイル名は TEXTFI~1.TXT<br>　と、MS-DOSファイル名が入れ替わってしまいます。（あくまでFATの場合ですよ）<br>　その後、エディタで textfile-1.txt を開こうとすると、エディタは<br>　C:\foo\TEXTFI~1.TXT を開こうとする → 開かれるのは textfile-2.txt になる。。。<br>　別のファイルが開かれるじゃん、と。<br><br>理由２<br>　Windows NT系 + NTFS の環境では、MS-DOSファイル名が存在しない場合がある。<br>　デフォルトの設定では常に全てのファイルに対してMS-DOSファイル名を生成して付加<br>　していくようになっていますが、設定を変えればMS-DOSファイル名を一切付けないように<br>　する事が可能です。（レジストリ NtfsDisable8dot3NameCreation）<br>　この場合、昔の“ロングファイル名を扱えないプログラム”等からファイルの読み書きが<br>　出来なくなります（ GetShortPathName() なんかも失敗する）が、代わりに若干<br>　パフォーマンスが向上します。<br><br>　こういう設定で使用している環境において使えないエディタになってしまうのでは？<br><br>MS-DOSファイル名の使用は何かとトラブルの元になりますので、<br>純Windowsアプリでは MS-DOSファイル名は利用すべきではないかと。<br></div></section>
    <ul><li><section><h1 id=3312>
    <span class="no">[3312]</span>
    <a class="title" href="#3312">Re9:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">wmlhq</span>
    <time datetime="2003-09-21T14:20:50">2003年09月21日 14:20</time></h1>
    <div class="body">いずれにしてもUnicode化は先送りということですね。続きは開発掲示板で。</div></section>
    <ul><li><section><h1 id=3315>
    <span class="no">[3315]</span>
    <a class="title" href="#3315">Re10:パスにunicodeを含む場合のファイルの開き方</a>
    <span class="author">すい</span>
    <time datetime="2003-09-24T08:53:48">2003年09月24日 08:53</time></h1>
    <div class="body">&gt;いずれにしてもUnicode化は先送りということですね。続きは開発掲示板で。<br><br>その開発掲示板の過去ログを見て頂ければわかると思いますが、、、<br>過去に Unicode化の計画が話し合われています。<br>その時はファイル名関連だけではなく、文字列編集等も含めたフルUnicode化の話だったわけですが．．．<br><br>ただ、あまりにも作業量が多く、部分毎に切り分けて少しずつ、一部分ずつUnicode化していく<br>というのも難しく（全部まとめてゴソっとやるしか．．．）、結局、事実上の計画頓挫状態<br>とでもいうのが今の状況なわけで。<br>新規機能追加時などに、将来のUnicode化を考慮したプログラミングにしておく、とか、<br>将来のUnicode化のために一部 少しだけ変更、とか、細々とした対応はされてはいますが。<br><br>よっぽどパワーと時間がある人が登場しない限りUnicode化は無理かと。<br></div></section>
    </li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></body></html>